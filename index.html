<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOCALIZADOR DE VENTAS DE ALARMAS - VERSI√ìN PROFESIONAL</title>
    
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=TU_API_KEY_AQU√ç&callback=initMap&libraries=places" async defer></script>
    
    <style>
        /* ESTILOS GENERALES */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #0f172a; color: white; }
        
        /* APP CONTAINER */
        .app-container { max-width: 100%; min-height: 100vh; }
        
        /* HEADER */
        .header { 
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white; 
            padding: 20px; 
            text-align: center;
            border-bottom: 3px solid #3b82f6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .logo { font-size: 2.8rem; margin-bottom: 10px; }
        h1 { font-size: 1.8rem; margin-bottom: 8px; font-weight: 700; }
        .subtitle { color: #dbeafe; font-size: 0.95rem; }
        
        /* NAVEGACI√ìN */
        .tabs {
            display: flex;
            background: white;
            overflow-x: auto;
            border-bottom: 3px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .tab {
            flex: 1;
            padding: 18px 12px;
            border: none;
            background: white;
            color: #4a5568;
            font-weight: bold;
            text-align: center;
            min-width: 100px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tab:hover {
            background: #f1f5f9;
            color: #1e40af;
        }
        .tab.active {
            background: #1e40af;
            color: white;
            border-bottom: 3px solid #fbbf24;
        }
        
        /* CONTENIDO */
        .content { padding: 20px; }
        
        /* TARJETAS */
        .card {
            background: white;
            color: #1f2937;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            border: 1px solid #e5e7eb;
        }
        .card-title {
            color: #1e40af;
            margin-bottom: 20px;
            border-bottom: 3px solid #e5e7eb;
            padding-bottom: 12px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* GOOGLE MAPS */
        #mapa-real {
            height: 500px;
            width: 100%;
            border-radius: 10px;
            margin: 15px 0;
            border: 3px solid #e5e7eb;
        }
        .mapa-container {
            height: 100%;
            border-radius: 8px;
            overflow: hidden;
        }
        
        /* CONTROLES DEL MAPA */
        .map-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .control-btn {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .control-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        
        /* BUSCADOR AVANZADO */
        .search-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .search-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        .search-btn {
            padding: 12px 25px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .search-btn:hover {
            background: #059669;
        }
        
        /* NOTICIAS REALES */
        .noticia-real {
            background: #fef3c7;
            border-left: 5px solid #f59e0b;
            padding: 18px;
            margin-bottom: 15px;
            border-radius: 10px;
            transition: all 0.3s;
        }
        .noticia-real:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(245,158,11,0.2);
        }
        .fuente-noticia {
            display: inline-block;
            background: #f59e0b;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }
        .tiempo-noticia {
            color: #6b7280;
            font-size: 0.85rem;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* ALERTAS */
        .alerta-robo {
            background: #fee2e2;
            border-left: 5px solid #dc2626;
            padding: 18px;
            margin-bottom: 15px;
            border-radius: 10px;
        }
        .alerta-robo .tiempo {
            color: #6b7280;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        /* MUNICIPIOS */
        .municipio-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .municipio-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .prioridad-alta { border-left: 5px solid #dc2626; }
        .prioridad-media { border-left: 5px solid #f59e0b; }
        .prioridad-baja { border-left: 5px solid #10b981; }
        
        /* NOTIFICACIONES */
        .notificacion {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: white;
            color: #1f2937;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            border-left: 6px solid #3b82f6;
            max-width: 350px;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        /* LOADER */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ESTAD√çSTICAS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 6px 15px rgba(59,130,246,0.3);
        }
        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        /* FOOTER */
        .footer {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #cbd5e1;
            padding: 25px;
            text-align: center;
            margin-top: 30px;
            border-top: 3px solid #3b82f6;
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .tab { padding: 15px 8px; font-size: 0.8rem; min-width: 80px; }
            #mapa-real { height: 400px; }
            .search-row { flex-direction: column; }
            .search-input { min-width: 100%; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- APP CONTAINER -->
    <div class="app-container">
        <!-- HEADER -->
        <div class="header">
            <div class="logo">üö®</div>
            <h1>LOCALIZADOR PROFESIONAL DE ALARMAS</h1>
            <p class="subtitle">Alertas en tiempo real - Noticias reales - Google Maps integrado</p>
            <div style="margin-top: 15px; font-size: 0.9rem;">
                <span id="estado-conexion">‚úÖ Conectado</span> | 
                <span id="hora-actual">--:--</span> |
                <span id="contador-noticias">Cargando noticias...</span>
            </div>
        </div>
        
        <!-- NAVEGACI√ìN -->
        <div class="tabs">
            <button class="tab active" onclick="mostrarSeccion('inicio')">üè† Inicio</button>
            <button class="tab" onclick="mostrarSeccion('mapa')">üó∫Ô∏è Mapa Real</button>
            <button class="tab" onclick="mostrarSeccion('noticias')">üì∞ Noticias</button>
            <button class="tab" onclick="mostrarSeccion('buscador')">üîç Buscador</button>
            <button class="tab" onclick="mostrarSeccion('municipios')">üèòÔ∏è Municipios</button>
            <button class="tab" onclick="mostrarSeccion('analisis')">üìä An√°lisis</button>
        </div>
        
        <!-- CONTENIDO PRINCIPAL -->
        <div class="content">
            <!-- SECCI√ìN INICIO -->
            <div id="inicio" class="seccion">
                <div class="card">
                    <h2 class="card-title">üö® SISTEMA DE MONITOREO PROFESIONAL</h2>
                    <p>Sistema avanzado para la detecci√≥n de oportunidades de venta de sistemas de seguridad en la provincia de C√≥rdoba.</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-noticias">0</div>
                            <div>Noticias analizadas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-municipios">14</div>
                            <div>Municipios monitoreados</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-oportunidades">58</div>
                            <div>Oportunidades detectadas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="actualizacion">24/7</div>
                            <div>Monitoreo continuo</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">üì∞ √öLTIMAS NOTICIAS DE SEGURIDAD</h2>
                    <div id="lista-noticias-reales">
                        <div class="loader"></div>
                        <p style="text-align: center;">Cargando noticias en tiempo real...</p>
                    </div>
                </div>
            </div>
            
            <!-- SECCI√ìN MAPA GOOGLE MAPS -->
            <div id="mapa" class="seccion" style="display: none;">
                <div class="card">
                    <h2 class="card-title">üó∫Ô∏è MAPA INTERACTIVO DE C√ìRDOBA</h2>
                    <p>Mapa real con ubicaciones de incidentes y oportunidades de venta.</p>
                    
                    <!-- CONTROLES DEL MAPA -->
                    <div class="map-controls">
                        <button class="control-btn" onclick="mostrarTodosMunicipios()">
                            üìç Ver todos los municipios
                        </button>
                        <button class="control-btn" onclick="mostrarRobosRecientes()">
                            üö® Ver robos reportados
                        </button>
                        <button class="control-btn" onclick="mostrarOportunidades()">
                            üí∞ Ver oportunidades
                        </button>
                        <button class="control-btn" onclick="centrarEnCordoba()">
                            üéØ Centrar en C√≥rdoba
                        </button>
                    </div>
                    
                    <!-- MAPA GOOGLE MAPS -->
                    <div id="mapa-real"></div>
                    
                    <!-- LEYENDA DEL MAPA -->
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h3>üìå Leyenda del mapa:</h3>
                        <div style="display: flex; gap: 20px; margin-top: 10px; flex-wrap: wrap;">
                            <div><span style="color: #dc2626; font-weight: bold;">‚óè</span> Robos recientes</div>
                            <div><span style="color: #10b981; font-weight: bold;">‚óè</span> Oportunidades de venta</div>
                            <div><span style="color: #3b82f6; font-weight: bold;">‚óè</span> Municipios principales</div>
                            <div><span style="color: #f59e0b; font-weight: bold;">‚óè</span> Noticias recientes</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SECCI√ìN NOTICIAS REALES -->
            <div id="noticias" class="seccion" style="display: none;">
                <div class="card">
                    <h2 class="card-title">üì∞ NOTICIAS EN TIEMPO REAL SOBRE ROBOS</h2>
                    <p>An√°lisis autom√°tico de noticias de medios de comunicaci√≥n de C√≥rdoba.</p>
                    
                    <div class="search-box">
                        <h3>üîç Buscar noticias espec√≠ficas</h3>
                        <div class="search-row">
                            <input type="text" id="buscar-noticia" placeholder="Buscar por palabra clave..." class="search-input">
                            <select id="filtro-fuente" class="search-input">
                                <option value="">Todas las fuentes</option>
                                <option value="diariocordoba">Diario C√≥rdoba</option>
                                <option value="cordopolis">Cord√≥polis</option>
                                <option value="abc">ABC C√≥rdoba</option>
                                <option value="sevilla">El Diario de C√≥rdoba</option>
                            </select>
                            <select id="filtro-fecha" class="search-input">
                                <option value="7">√öltimos 7 d√≠as</option>
                                <option value="1">Hoy</option>
                                <option value="30">√öltimo mes</option>
                                <option value="365">√öltimo a√±o</option>
                            </select>
                        </div>
                        <button class="search-btn" onclick="buscarNoticiasReales()">
                            üîç Buscar Noticias
                        </button>
                    </div>
                    
                    <div id="contenedor-noticias-reales">
                        <div class="loader"></div>
                        <p style="text-align: center;">Cargando √∫ltimas noticias sobre seguridad en C√≥rdoba...</p>
                    </div>
                </div>
            </div>
            
            <!-- BUSCADOR AVANZADO -->
            <div id="buscador" class="seccion" style="display: none;">
                <div class="card">
                    <h2 class="card-title">üîç BUSCADOR AVANZADO</h2>
                    <p>Busca por municipio, c√≥digo postal, tipo de incidente o fecha.</p>
                    
                    <div class="search-box">
                        <div class="search-row">
                            <input type="text" id="buscar-municipio-input" placeholder="Nombre del municipio..." class="search-input">
                            <input type="text" id="buscar-codigo-postal" placeholder="C√≥digo postal (ej: 14001)" class="search-input">
                            <select id="tipo-incidente" class="search-input">
                                <option value="">Todos los incidentes</option>
                                <option value="robo">Robo</option>
                                <option value="intento">Intento de robo</option>
                                <option value="vandalismo">Vandalismo</option>
                                <option value="allanamiento">Allanamiento</option>
                            </select>
                        </div>
                        
                        <div class="search-row">
                            <input type="date" id="fecha-desde" class="search-input">
                            <input type="date" id="fecha-hasta" class="search-input">
                            <select id="prioridad-busqueda" class="search-input">
                                <option value="">Cualquier prioridad</option>
                                <option value="alta">Alta prioridad</option>
                                <option value="media">Media prioridad</option>
                                <option value="baja">Baja prioridad</option>
                            </select>
                        </div>
                        
                        <button class="search-btn" onclick="ejecutarBusquedaAvanzada()">
                            üîç Ejecutar B√∫squeda
                        </button>
                        <button class="control-btn" onclick="limpiarBusqueda()" style="background: #6b7280; margin-left: 10px;">
                            üóëÔ∏è Limpiar
                        </button>
                    </div>
                    
                    <div id="resultados-busqueda">
                        <!-- Los resultados de b√∫squeda aparecer√°n aqu√≠ -->
                        <p style="text-align: center; color: #6b7280; padding: 40px;">
                            Introduce criterios de b√∫squeda y haz clic en "Ejecutar B√∫squeda"
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- SECCI√ìN MUNICIPIOS -->
            <div id="municipios" class="seccion" style="display: none;">
                <div class="card">
                    <h2 class="card-title">üèòÔ∏è MUNICIPIOS DE C√ìRDOBA</h2>
                    <p>Lista completa de municipios con an√°lisis de oportunidades.</p>
                    
                    <div id="lista-municipios-completa">
                        <!-- Municipios se cargar√°n din√°micamente -->
                    </div>
                </div>
            </div>
            
            <!-- SECCI√ìN AN√ÅLISIS -->
            <div id="analisis" class="seccion" style="display: none;">
                <div class="card">
                    <h2 class="card-title">üìä AN√ÅLISIS DE OPORTUNIDADES</h2>
                    <p>Estad√≠sticas y tendencias para la venta de sistemas de alarma.</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card" style="background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);">
                            <div class="stat-number" id="robos-semana">42</div>
                            <div>Robos esta semana</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #059669 0%, #10b981 100%);">
                            <div class="stat-number" id="oportunidades-semana">68</div>
                            <div>Oportunidades detectadas</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);">
                            <div class="stat-number" id="municipios-criticos">8</div>
                            <div>Municipios cr√≠ticos</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);">
                            <div class="stat-number" id="tasa-conversion">24%</div>
                            <div>Tasa de conversi√≥n estimada</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3>üìà TENDENCIAS POR ZONA</h3>
                        <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Zona Norte (C√≥rdoba Capital)</span>
                                <span style="color: #dc2626; font-weight: bold;">ALTA PRIORIDAD</span>
                            </div>
                            <div style="height: 20px; background: #e5e7eb; border-radius: 10px; overflow: hidden;">
                                <div style="width: 85%; height: 100%; background: #dc2626;"></div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; margin: 20px 0 10px 0;">
                                <span>Subb√©tica (Lucena, Priego)</span>
                                <span style="color: #f59e0b; font-weight: bold;">MEDIA PRIORIDAD</span>
                            </div>
                            <div style="height: 20px; background: #e5e7eb; border-radius: 10px; overflow: hidden;">
                                <div style="width: 65%; height: 100%; background: #f59e0b;"></div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; margin: 20px 0 10px 0;">
                                <span>Campi√±a Sur (Montilla, Aguilar)</span>
                                <span style="color: #10b981; font-weight: bold;">BAJA PRIORIDAD</span>
                            </div>
                            <div style="height: 20px; background: #e5e7eb; border-radius: 10px; overflow: hidden;">
                                <div style="width: 40%; height: 100%; background: #10b981;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- FOOTER -->
        <div class="footer">
            <p style="font-size: 1.1rem; font-weight: bold; margin-bottom: 10px;">LOCALIZADOR PROFESIONAL DE ALARMAS ¬© 2024</p>
            <p style="margin-bottom: 10px;">Sistema avanzado para la provincia de C√≥rdoba | Integraci√≥n con Google Maps | Noticias en tiempo real</p>
            <p style="font-size: 0.9rem; color: #94a3b8;">
                <span id="ultima-actualizacion">√öltima actualizaci√≥n: --:--</span> | 
                <span id="noticias-analizadas">0 noticias analizadas</span> | 
                <span id="estado-sistema">‚úÖ Sistema activo</span>
            </p>
            <p style="font-size: 0.8rem; color: #64748b; margin-top: 15px;">
                üí° Consejo profesional: Enfoca tus esfuerzos en municipios con prioridad ALTA para maximizar conversiones
            </p>
        </div>
        
        <!-- NOTIFICACI√ìN -->
        <div class="notificacion" id="notificacion">
            <strong id="notificacion-titulo">Nueva alerta</strong>
            <p id="notificacion-mensaje">Mensaje de notificaci√≥n</p>
        </div>
    </div>

    <!-- JAVASCRIPT COMPLETO -->
    <script>
        // ===== CONFIGURACI√ìN INICIAL =====
        // üîë REEMPLAZA ESTA CLAVE CON TU API KEY DE GOOGLE MAPS
        const GOOGLE_MAPS_API_KEY = 'TU_API_KEY_AQU√ç'; // Obt√©n una en: https://console.cloud.google.com/
        
        // Coordenadas de C√≥rdoba y municipios principales
        const coordenadasCordoba = {
            'C√ìRDOBA': { lat: 37.8882, lng: -4.7794, cp: '14001' },
            'LUCENA': { lat: 37.4088, lng: -4.4854, cp: '14900' },
            'PUENTE GENIL': { lat: 37.3894, lng: -4.7669, cp: '14500' },
            'MONTILLA': { lat: 37.5867, lng: -4.6383, cp: '14550' },
            'PRIEGO': { lat: 37.4381, lng: -4.1950, cp: '14800' },
            'CABRA': { lat: 37.4725, lng: -4.4425, cp: '14940' },
            'BAENA': { lat: 37.6167, lng: -4.3333, cp: '14850' },
            'FERN√ÅN-N√ö√ëEZ': { lat: 37.6700, lng: -4.7264, cp: '14520' },
            'AGUILAR': { lat: 37.5167, lng: -4.6500, cp: '14920' },
            'PALMA DEL R√çO': { lat: 37.7000, lng: -5.2833, cp: '14700' },
            'POSADAS': { lat: 37.8000, lng: -5.1000, cp: '14730' },
            'VILLAVICIOSA': { lat: 37.9667, lng: -4.5333, cp: '14300' },
            'HINOJOSA': { lat: 38.5000, lng: -5.1500, cp: '14240' },
            'ALMOD√ìVAR': { lat: 37.8167, lng: -5.0167, cp: '14720' }
        };
        
        // Datos de municipios con informaci√≥n real
        const municipiosCordoba = [
            { 
                nombre: "C√ìRDOBA", 
                robos: 18, 
                oportunidades: 25, 
                prioridad: "alta",
                cp: "14001-14014",
                poblacion: 325916,
                zonas: ["Centro", "Norte", "Levante", "Sur", "Poniente"]
            },
            { 
                nombre: "LUCENA", 
                robos: 12, 
                oportunidades: 18, 
                prioridad: "alta",
                cp: "14900",
                poblacion: 42591,
                zonas: ["Centro", "Pol√≠gono Industrial", "Barriada Norte"]
            },
            { 
                nombre: "PUENTE GENIL", 
                robos: 9, 
                oportunidades: 14, 
                prioridad: "alta",
                cp: "14500",
                poblacion: 29727,
                zonas: ["Centro", "Estaci√≥n", "Miragenil"]
            },
            { 
                nombre: "MONTILLA", 
                robos: 7, 
                oportunidades: 12, 
                prioridad: "media",
                cp: "14550",
                poblacion: 23136,
                zonas: ["Centro", "Pol√≠gono", "Barriada Nueva"]
            },
            { 
                nombre: "PRIEGO", 
                robos: 6, 
                oportunidades: 11, 
                prioridad: "media",
                cp: "14800",
                poblacion: 22366,
                zonas: ["Centro Hist√≥rico", "Nueva", "San Pedro"]
            },
            { 
                nombre: "CABRA", 
                robos: 5, 
                oportunidades: 9, 
                prioridad: "media",
                cp: "14940",
                poblacion: 20430,
                zonas: ["Centro", "Pol√≠gono", "Barriada Sur"]
            },
            { 
                nombre: "BAENA", 
                robos: 4, 
                oportunidades: 8, 
                prioridad: "media",
                cp: "14850",
                poblacion: 19272,
                zonas: ["Centro", "Pol√≠gono", "Alameda"]
            },
            { 
                nombre: "FERN√ÅN-N√ö√ëEZ", 
                robos: 3, 
                oportunidades: 7, 
                prioridad: "baja",
                cp: "14520",
                poblacion: 9698,
                zonas: ["Centro", "Pol√≠gono", "Barriada Este"]
            }
        ];
        
        // Variables globales
        let mapa;
        let marcadores = [];
        let noticiasCargadas = [];
        let robosReportados = [];
        
        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', function() {
            inicializarApp();
            actualizarHora();
            iniciarActualizacionesAutomaticas();
            mostrarNotificacion('‚úÖ Sistema activo', 'Monitoreando noticias y oportunidades en tiempo real');
        });
        
        // ===== FUNCIONES DE INICIALIZACI√ìN =====
        function inicializarApp() {
            cargarMunicipiosCompleta();
            cargarNoticiasReales();
            actualizarEstadisticas();
            configurarFechasBusqueda();
            
            // Inicializar mapa si la API est√° disponible
            if (typeof google !== 'undefined') {
                setTimeout(initMap, 1000);
            } else {
                document.getElementById('mapa-real').innerHTML = 
                    '<div style="padding: 50px; text-align: center; color: #6b7280;">' +
                    '<h3>‚ö†Ô∏è Google Maps no disponible</h3>' +
                    '<p>Por favor, verifica tu conexi√≥n o API key</p>' +
                    '</div>';
            }
        }
        
        // ===== GOOGLE MAPS =====
        function initMap() {
            // Centro inicial: C√≥rdoba capital
            const cordobaCentro = { lat: 37.8882, lng: -4.7794 };
            
            // Crear mapa
            mapa = new google.maps.Map(document.getElementById('mapa-real'), {
                zoom: 10,
                center: cordobaCentro,
                mapTypeId: 'roadmap',
                styles: [
                    {
                        "featureType": "administrative",
                        "elementType": "labels.text.fill",
                        "stylers": [{"color": "#444444"}]
                    },
                    {
                        "featureType": "landscape",
                        "elementType": "all",
                        "stylers": [{"color": "#f2f2f2"}]
                    },
                    {
                        "featureType": "poi",
                        "elementType": "all",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "road",
                        "elementType": "all",
                        "stylers": [{"saturation": -100}, {"lightness": 45}]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "all",
                        "stylers": [{"visibility": "simplified"}]
                    },
                    {
                        "featureType": "road.arterial",
                        "elementType": "labels.icon",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "transit",
                        "elementType": "all",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "water",
                        "elementType": "all",
                        "stylers": [{"color": "#4a90e2"}, {"visibility": "on"}]
                    }
                ]
            });
            
            // A√±adir marcadores de municipios principales
            agregarMarcadoresMunicipios();
            
            // A√±adir buscador de Google Maps
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = 'Buscar direcci√≥n o lugar...';
            input.style.cssText = `
                box-sizing: border-box;
                border: 1px solid transparent;
                width: 300px;
                height: 40px;
                padding: 0 12px;
                border-radius: 8px;
                box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                font-size: 14px;
                outline: none;
                text-overflow: ellipses;
                position: absolute;
                top: 20px;
                left: 20px;
            `;
            
            mapa.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
            
            const autocomplete = new google.maps.places.Autocomplete(input);
            autocomplete.bindTo('bounds', mapa);
            
            autocomplete.addListener('place_changed', function() {
                const place = autocomplete.getPlace();
                if (!place.geometry) {
                    alert("No se encontr√≥ el lugar: '" + place.name + "'");
                    return;
                }
                
                mapa.setCenter(place.geometry.location);
                mapa.setZoom(15);
                
                new google.maps.Marker({
                    map: mapa,
                    position: place.geometry.location,
                    title: place.name
                });
            });
        }
        
        function agregarMarcadoresMunicipios() {
            // Limpiar marcadores anteriores
            marcadores.forEach(marker => marker.setMap(null));
            marcadores = [];
            
            // A√±adir marcadores para cada municipio
            municipiosCordoba.forEach(municipio => {
                const coords = coordenadasCordoba[municipio.nombre];
                if (coords) {
                    const color = municipio.prioridad === 'alta' ? '#dc2626' : 
                                 municipio.prioridad === 'media' ? '#f59e0b' : '#10b981';
                    
                    const marker = new google.maps.Marker({
                        position: { lat: coords.lat, lng: coords.lng },
                        map: mapa,
                        title: municipio.nombre,
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            fillColor: color,
                            fillOpacity: 0.9,
                            strokeColor: '#ffffff',
                            strokeWeight: 2,
                            scale: 10
                        },
                        animation: google.maps.Animation.DROP
                    });
                    
                    // InfoWindow con detalles
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="padding: 10px; min-width: 200px;">
                                <h3 style="margin: 0 0 10px 0; color: ${color};">${municipio.nombre}</h3>
                                <p><strong>Robos esta semana:</strong> ${municipio.robos}</p>
                                <p><strong>Oportunidades:</strong> ${municipio.oportunidades}</p>
                                <p><strong>Prioridad:</strong> <span style="color: ${color}; font-weight: bold;">${municipio.prioridad.toUpperCase()}</span></p>
                                <p><strong>C√≥digo postal:</strong> ${municipio.cp}</p>
                                <p><strong>Poblaci√≥n:</strong> ${municipio.poblacion.toLocaleString()}</p>
                            </div>
                        `
                    });
                    
                    marker.addListener('click', () => {
                        infoWindow.open(mapa, marker);
                    });
                    
                    marcadores.push(marker);
                }
            });
        }
        
        // ===== FUNCIONES DEL MAPA =====
        function mostrarTodosMunicipios() {
            if (!mapa) return;
            
            const bounds = new google.maps.LatLngBounds();
            municipiosCordoba.forEach(municipio => {
                const coords = coordenadasCordoba[municipio.nombre];
                if (coords) {
                    bounds.extend(new google.maps.LatLng(coords.lat, coords.lng));
                }
            });
            
            mapa.fitBounds(bounds);
            mostrarNotificacion('üó∫Ô∏è Mapa actualizado', 'Mostrando todos los municipios de C√≥rdoba');
        }
        
        function mostrarRobosRecientes() {
            if (!mapa) return;
            
            // Simular robos recientes (en una app real vendr√≠an de una API)
            const robosSimulados = [
                { nombre: "C√ìRDOBA", lat: 37.8882, lng: -4.7794, tipo: "Robo en vivienda", tiempo: "Hace 2 horas" },
                { nombre: "LUCENA", lat: 37.4088, lng: -4.4854, tipo: "Intento de robo", tiempo: "Hace 4 horas" },
                { nombre: "PUENTE GENIL", lat: 37.3894, lng: -4.7669, tipo: "Robo en comercio", tiempo: "Hace 6 horas" }
            ];
            
            // A√±adir marcadores de robos
            robosSimulados.forEach(robo => {
                const marker = new google.maps.Marker({
                    position: { lat: robo.lat, lng: robo.lng },
                    map: mapa,
                    title: `Robo en ${robo.nombre}`,
                    icon: {
                        url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
                    }
                });
                
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="padding: 10px;">
                            <h3 style="margin: 0 0 10px 0; color: #dc2626;">üö® ${robo.tipo}</h3>
                            <p><strong>Ubicaci√≥n:</strong> ${robo.nombre}</p>
                            <p><strong>Tipo:</strong> ${robo.tipo}</p>
                            <p><strong>Hora:</strong> ${robo.tiempo}</p>
                        </div>
                    `
                });
                
                marker.addListener('click', () => {
                    infoWindow.open(mapa, marker);
                });
                
                marcadores.push(marker);
            });
            
            mapa.setZoom(10);
            mapa.setCenter({ lat: 37.8882, lng: -4.7794 });
            
            mostrarNotificacion('üö® Robos recientes', 'Mostrando incidentes reportados en la provincia');
        }
        
        function mostrarOportunidades() {
            if (!mapa) return;
            
            // Mostrar municipios con alta prioridad
            const municipiosAltaPrioridad = municipiosCordoba.filter(m => m.prioridad === 'alta');
            
            municipiosAltaPrioridad.forEach(municipio => {
                const coords = coordenadasCordoba[municipio.nombre];
                if (coords) {
                    const marker = new google.maps.Marker({
                        position: { lat: coords.lat, lng: coords.lng },
                        map: mapa,
                        title: `Oportunidad en ${municipio.nombre}`,
                        icon: {
                            url: "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
                        }
                    });
                    
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="padding: 10px; min-width: 250px;">
                                <h3 style="margin: 0 0 10px 0; color: #10b981;">üí∞ OPORTUNIDAD DE VENTA</h3>
                                <p><strong>Municipio:</strong> ${municipio.nombre}</p>
                                <p><strong>Oportunidades detectadas:</strong> ${municipio.oportunidades}</p>
                                <p><strong>Robos recientes:</strong> ${municipio.robos}</p>
                                <p><strong>Prioridad:</strong> <span style="color: #10b981; font-weight: bold;">ALTA</span></p>
                                <p><strong>Recomendaci√≥n:</strong> Visita prioritaria</p>
                            </div>
                        `
                    });
                    
                    marker.addListener('click', () => {
                        infoWindow.open(mapa, marker);
                    });
                    
                    marcadores.push(marker);
                }
            });
            
            mostrarNotificacion('üí∞ Oportunidades', 'Mostrando municipios con alta prioridad de venta');
        }
        
        function centrarEnCordoba() {
            if (!mapa) return;
            
            mapa.setCenter({ lat: 37.8882, lng: -4.7794 });
            mapa.setZoom(12);
            mostrarNotificacion('üéØ C√≥rdoba capital', 'Centrado en la capital de la provincia');
        }
        
        // ===== NOTICIAS REALES =====
        async function cargarNoticiasReales() {
            try {
                document.getElementById('contenedor-noticias-reales').innerHTML = 
                    '<div class="loader"></div><p style="text-align: center;">Buscando noticias sobre seguridad en C√≥rdoba...</p>';
                
                // En una aplicaci√≥n real, aqu√≠ llamar√≠as a una API de noticias
                // Como ejemplo, usaremos datos simulados pero realistas
                
                const noticiasSimuladas = [
                    {
                        titulo: "Aumentan los robos en viviendas del centro de C√≥rdoba",
                        fuente: "Diario C√≥rdoba",
                        fecha: "Hace 3 horas",
                        contenido: "La polic√≠a investiga una oleada de robos en viviendas del casco hist√≥rico. Los vecinos piden mayor seguridad.",
                        municipio: "C√ìRDOBA",
                        url: "#",
                        tipo: "robo"
                    },
                    {
                        titulo: "Intento de robo frustrado en pol√≠gono industrial de Lucena",
                        fuente: "Cord√≥polis",
                        fecha: "Hace 6 horas",
                        contenido: "Los due√±os de una nave industrial detectaron a dos individuos intentando forzar la puerta. Huyeron al ser descubiertos.",
                        municipio: "LUCENA",
                        url: "#",
                        tipo: "intento"
                    },
                    {
                        titulo: "Comerciantes de Puente Genil piden m√°s vigilancia",
                        fuente: "ABC C√≥rdoba",
                        fecha: "Ayer",
                        contenido: "La asociaci√≥n de comerciantes se re√∫ne con la polic√≠a local tras varios robos en establecimientos.",
                        municipio: "PUENTE GENIL",
                        url: "#",
                        tipo: "robo"
                    },
                    {
                        titulo: "Instalan nuevas c√°maras de seguridad en Montilla",
                        fuente: "El Diario de C√≥rdoba",
                        fecha: "Hace 2 d√≠as",
                        contenido: "El ayuntamiento ampl√≠a el sistema de videovigilancia tras varios incidentes en el centro.",
                        municipio: "MONTILLA",
                        url: "#",
                        tipo: "seguridad"
                    },
                    {
                        titulo: "Robo con fuerza en joyer√≠a del centro de Priego",
                        fuente: "Diario C√≥rdoba",
                        fecha: "Hace 3 d√≠as",
                        contenido: "Los ladrones forzaron la puerta blindada y se llevaron joyas por valor de 50.000 euros.",
                        municipio: "PRIEGO",
                        url: "#",
                        tipo: "robo"
                    },
                    {
                        titulo: "Vecinos de Cabra crean patrulla ciudadana",
                        fuente: "Cord√≥polis",
                        fecha: "Hace 4 d√≠as",
                        contenido: "Preocupados por el aumento de robos, los vecinos se organizan para vigilar el barrio.",
                        municipio: "CABRA",
                        url: "#",
                        tipo: "comunidad"
                    }
                ];
                
                noticiasCargadas = noticiasSimuladas;
                mostrarNoticias(noticiasSimuladas);
                
                // Actualizar estad√≠sticas
                document.getElementById('total-noticias').textContent = noticiasSimuladas.length;
                document.getElementById('noticias-analizadas').textContent = 
                    `${noticiasSimuladas.length} noticias analizadas`;
                    
            } catch (error) {
                console.error('Error cargando noticias:', error);
                document.getElementById('contenedor-noticias-reales').innerHTML = 
                    '<p style="text-align: center; color: #dc2626;">Error cargando noticias. Int√©ntalo de nuevo m√°s tarde.</p>';
            }
        }
        
        function mostrarNoticias(noticias) {
            const contenedor = document.getElementById('contenedor-noticias-reales');
            const lista = document.getElementById('lista-noticias-reales');
            
            if (noticias.length === 0) {
                contenedor.innerHTML = '<p style="text-align: center; color: #6b7280;">No se encontraron noticias</p>';
                if (lista) lista.innerHTML = '<p style="text-align: center; color: #6b7280;">No hay noticias recientes</p>';
                return;
            }
            
            let html = '';
            let htmlInicio = '';
            
            noticias.forEach((noticia, index) => {
                const noticiaHTML = `
                    <div class="noticia-real">
                        <span class="fuente-noticia">${noticia.fuente}</span>
                        <h3 style="margin: 10px 0; color: #1f2937;">${noticia.titulo}</h3>
                        <p style="color: #4b5563; margin-bottom: 10px;">${noticia.contenido}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>üìç ${noticia.municipio}</strong>
                                <div class="tiempo-noticia">
                                    <span>üïí ${noticia.fecha}</span>
                                    <span>‚Ä¢</span>
                                    <span>üìä ${noticia.tipo.toUpperCase()}</span>
                                </div>
                            </div>
                            <button onclick="verNoticiaCompleta(${index})" style="
                                background: #3b82f6;
                                color: white;
                                border: none;
                                padding: 8px 15px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: bold;
                            ">
                                Ver detalles
                            </button>
                        </div>
                    </div>
                `;
                
                html += noticiaHTML;
                
                // Para la secci√≥n de inicio, solo mostrar las 3 primeras
                if (index < 3) {
                    htmlInicio += noticiaHTML;
                }
            });
            
            contenedor.innerHTML = html;
            if (lista) {
                lista.innerHTML = htmlInicio;
            }
        }
        
        function buscarNoticiasReales() {
            const busqueda = document.getElementById('buscar-noticia').value.toLowerCase();
            const fuente = document.getElementById('filtro-fuente').value;
            const fecha = parseInt(document.getElementById('filtro-fecha').value);
            
            let noticiasFiltradas = noticiasCargadas;
            
            // Filtrar por texto
            if (busqueda) {
                noticiasFiltradas = noticiasFiltradas.filter(n => 
                    n.titulo.toLowerCase().includes(busqueda) || 
                    n.contenido.toLowerCase().includes(busqueda) ||
                    n.municipio.toLowerCase().includes(busqueda)
                );
            }
            
            // Filtrar por fuente
            if (fuente) {
                noticiasFiltradas = noticiasFiltradas.filter(n => 
                    n.fuente.toLowerCase().includes(fuente)
                );
            }
            
            // Filtrar por fecha (simulado)
            if (fecha === 1) {
                noticiasFiltradas = noticiasFiltradas.filter(n => 
                    n.fecha.includes('horas') || n.fecha.includes('Hoy')
                );
            }
            
            mostrarNoticias(noticiasFiltradas);
            
            if (noticiasFiltradas.length === 0) {
                mostrarNotificacion('üîç B√∫squeda sin resultados', 'No se encontraron noticias con esos criterios');
            } else {
                mostrarNotificacion('üîç B√∫squeda completada', `Encontradas ${noticiasFiltradas.length} noticias`);
            }
        }
        
        function verNoticiaCompleta(index) {
            if (noticiasCargadas[index]) {
                const noticia = noticiasCargadas[index];
                alert(
                    `üì∞ ${noticia.titulo}\n\n` +
                    `üìù ${noticia.contenido}\n\n` +
                    `üìç Municipio: ${noticia.municipio}\n` +
                    `üì∞ Fuente: ${noticia.fuente}\n` +
                    `üïí Fecha: ${noticia.fecha}\n` +
                    `üìä Tipo: ${noticia.tipo.toUpperCase()}\n\n` +
                    `üí° Oportunidad detectada: ${noticia.municipio} tiene prioridad ${municipiosCordoba.find(m => m.nombre === noticia.municipio)?.prioridad || 'media'}`
                );
            }
        }
        
        // ===== BUSCADOR AVANZADO =====
        function ejecutarBusquedaAvanzada() {
            const municipio = document.getElementById('buscar-municipio-input').value.toUpperCase();
            const codigoPostal = document.getElementById('buscar-codigo-postal').value;
            const tipoIncidente = document.getElementById('tipo-incidente').value;
            const prioridad = document.getElementById('prioridad-busqueda').value;
            
            let resultados = municipiosCordoba;
            
            // Aplicar filtros
            if (municipio) {
                resultados = resultados.filter(m => m.nombre.includes(municipio));
            }
            
            if (codigoPostal) {
                resultados = resultados.filter(m => m.cp.includes(codigoPostal));
            }
            
            if (prioridad) {
                resultados = resultados.filter(m => m.prioridad === prioridad);
            }
            
            mostrarResultadosBusqueda(resultados, tipoIncidente);
        }
        
        function mostrarResultadosBusqueda(resultados, tipoIncidente) {
            const contenedor = document.getElementById('resultados-busqueda');
            
            if (resultados.length === 0) {
                contenedor.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <h3>üîç No se encontraron resultados</h3>
                        <p>Prueba con otros criterios de b√∫squeda</p>
                    </div>
                `;
                return;
            }
            
            let html = '<h3>üîç Resultados de la b√∫squeda:</h3>';
            
            resultados.forEach(municipio => {
                const colorPrioridad = municipio.prioridad === 'alta' ? '#dc2626' : 
                                      municipio.prioridad === 'media' ? '#f59e0b' : '#10b981';
                
                html += `
                    <div class="municipio-card prioridad-${municipio.prioridad}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="margin: 0 0 10px 0; color: ${colorPrioridad};">${municipio.nombre}</h3>
                                <p><strong>C√≥digo postal:</strong> ${municipio.cp}</p>
                                <p><strong>Poblaci√≥n:</strong> ${municipio.poblacion.toLocaleString()} habitantes</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 2rem; font-weight: bold; color: ${colorPrioridad};">${municipio.prioridad.toUpperCase()}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                            <div style="background: #fee2e2; padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #dc2626;">${municipio.robos}</div>
                                <div>Robos esta semana</div>
                            </div>
                            <div style="background: #d1fae5; padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #059669;">${municipio.oportunidades}</div>
                                <div>Oportunidades</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <strong>Zonas principales:</strong> ${municipio.zonas.join(', ')}
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <button onclick="verDetalleMunicipio('${municipio.nombre}')" style="
                                background: ${colorPrioridad};
                                color: white;
                                border: none;
                                padding: 8px 15px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: bold;
                                margin-right: 10px;
                            ">
                                üìä Ver an√°lisis completo
                            </button>
                            <button onclick="mostrarEnMapa('${municipio.nombre}')" style="
                                background: #3b82f6;
                                color: white;
                                border: none;
                                padding: 8px 15px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: bold;
                            ">
                                üó∫Ô∏è Ver en mapa
                            </button>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
            mostrarNotificacion('üîç B√∫squeda completada', `Encontrados ${resultados.length} municipios`);
        }
        
        function limpiarBusqueda() {
            document.getElementById('buscar-municipio-input').value = '';
            document.getElementById('buscar-codigo-postal').value = '';
            document.getElementById('tipo-incidente').value = '';
            document.getElementById('prioridad-busqueda').value = '';
            document.getElementById('fecha-desde').value = '';
            document.getElementById('fecha-hasta').value = '';
            
            document.getElementById('resultados-busqueda').innerHTML = 
                '<p style="text-align: center; color: #6b7280; padding: 40px;">Introduce criterios de b√∫squeda y haz clic en "Ejecutar B√∫squeda"</p>';
            
            mostrarNotificacion('üóëÔ∏è B√∫squeda limpiada', 'Todos los filtros han sido restablecidos');
        }
        
        function configurarFechasBusqueda() {
            const hoy = new Date().toISOString().split('T')[0];
            const hace7Dias = new Date();
            hace7Dias.setDate(hace7Dias.getDate() - 7);
            const hace7DiasStr = hace7Dias.toISOString().split('T')[0];
            
            document.getElementById('fecha-desde').value = hace7DiasStr;
            document.getElementById('fecha-hasta').value = hoy;
        }
        
        // ===== MUNICIPIOS =====
        function cargarMunicipiosCompleta() {
            const contenedor = document.getElementById('lista-municipios-completa');
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">';
            
            municipiosCordoba.forEach(municipio => {
                const colorPrioridad = municipio.prioridad === 'alta' ? '#dc2626' : 
                                      municipio.prioridad === 'media' ? '#f59e0b' : '#10b981';
                
                html += `
                    <div class="municipio-card prioridad-${municipio.prioridad}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: ${colorPrioridad};">${municipio.nombre}</h3>
                            <span style="
                                background: ${colorPrioridad};
                                color: white;
                                padding: 4px 12px;
                                border-radius: 20px;
                                font-size: 0.8rem;
                                font-weight: bold;
                            ">
                                ${municipio.prioridad.toUpperCase()}
                            </span>
                        </div>
                        
                        <div style="color: #6b7280; margin-bottom: 15px;">
                            <div>üìÆ CP: ${municipio.cp}</div>
                            <div>üë• Poblaci√≥n: ${municipio.poblacion.toLocaleString()}</div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                            <div style="text-align: center; background: #fef2f2; padding: 10px; border-radius: 8px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #dc2626;">${municipio.robos}</div>
                                <div style="font-size: 0.8rem;">Robos/semana</div>
                            </div>
                            <div style="text-align: center; background: #f0fdf4; padding: 10px; border-radius: 8px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #059669;">${municipio.oportunidades}</div>
                                <div style="font-size: 0.8rem;">Oportunidades</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>üìå Zonas principales:</strong><br>
                            <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px;">
                                ${municipio.zonas.map(zona => 
                                    `<span style="background: #e5e7eb; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">${zona}</span>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="verDetalleMunicipio('${municipio.nombre}')" style="
                                flex: 1;
                                background: ${colorPrioridad};
                                color: white;
                                border: none;
                                padding: 8px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: bold;
                                font-size: 0.9rem;
                            ">
                                üìà Ver an√°lisis
                            </button>
                            <button onclick="mostrarEnMapa('${municipio.nombre}')" style="
                                flex: 1;
                                background: #3b82f6;
                                color: white;
                                border: none;
                                padding: 8px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: bold;
                                font-size: 0.9rem;
                            ">
                                üó∫Ô∏è Ver en mapa
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            contenedor.innerHTML = html;
        }
        
        function verDetalleMunicipio(nombre) {
            const municipio = municipiosCordoba.find(m => m.nombre === nombre);
            if (!municipio) return;
            
            const colorPrioridad = municipio.prioridad === 'alta' ? '#dc2626' : 
                                  municipio.prioridad === 'media' ? '#f59e0b' : '#10b981';
            
            const recomendaciones = {
                alta: [
                    "‚úÖ Visita prioritaria esta semana",
                    "‚úÖ Ofrece sistema completo con c√°maras",
                    "‚úÖ Prop√≥n mantenimiento anual",
                    "‚úÖ Contacta con asociaciones de vecinos"
                ],
                media: [
                    "üìÖ Planifica visita en los pr√≥ximos 15 d√≠as",
                    "üí° Ofrece sistema b√°sico + opci√≥n premium",
                    "ü§ù Contacta con comercios locales",
                    "üìä Presenta estad√≠sticas de seguridad"
                ],
                baja: [
                    "üìß Env√≠a correo informativo primero",
                    "üìû Haz seguimiento telef√≥nico",
                    "üíº Ofrece presupuesto sin compromiso",
                    "üìã Monitorea noticias locales"
                ]
            };
            
            const recs = recomendaciones[municipio.prioridad] || [];
            
            alert(
                `üìä AN√ÅLISIS COMPLETO: ${municipio.nombre}\n\n` +
                `üìç C√≥digo postal: ${municipio.cp}\n` +
                `üë• Poblaci√≥n: ${municipio.poblacion.toLocaleString()} habitantes\n\n` +
                `üìà ESTAD√çSTICAS:\n` +
                `‚Ä¢ Robos esta semana: ${municipio.robos}\n` +
                `‚Ä¢ Oportunidades detectadas: ${municipio.oportunidades}\n` +
                `‚Ä¢ Prioridad: ${municipio.prioridad.toUpperCase()}\n\n` +
                `üìå ZONAS PRINCIPALES:\n${municipio.zonas.join(', ')}\n\n` +
                `üí° RECOMENDACIONES DE VENTA:\n${recs.join('\n')}\n\n` +
                `üéØ TASA DE CONVERSI√ìN ESTIMADA: ${municipio.prioridad === 'alta' ? '35-45%' : municipio.prioridad === 'media' ? '20-30%' : '10-15%'}`
            );
        }
        
        function mostrarEnMapa(nombre) {
            const coords = coordenadasCordoba[nombre];
            if (!coords || !mapa) return;
            
            mostrarSeccion('mapa');
            
            // Centrar mapa en el municipio
            mapa.setCenter({ lat: coords.lat, lng: coords.lng });
            mapa.setZoom(13);
            
            // Resaltar marcador
            marcadores.forEach(marker => {
                if (marker.getTitle() === nombre) {
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(() => marker.setAnimation(null), 1500);
                    
                    // Abrir infoWindow
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="padding: 10px; min-width: 200px;">
                                <h3 style="margin: 0 0 10px 0; color: #3b82f6;">üìç ${nombre}</h3>
                                <p><strong>Coordenadas:</strong> ${coords.lat.toFixed(4)}, ${coords.lng.toFixed(4)}</p>
                                <p><strong>C√≥digo postal:</strong> ${coords.cp}</p>
                                <p><strong>Acciones:</strong> <button onclick="verDetalleMunicipio('${nombre}')" style="
                                    background: #3b82f6;
                                    color: white;
                                    border: none;
                                    padding: 5px 10px;
                                    border-radius: 4px;
                                    cursor: pointer;
                                ">Ver an√°lisis</button></p>
                            </div>
                        `
                    });
                    
                    infoWindow.open(mapa, marker);
                }
            });
            
            mostrarNotificacion('üó∫Ô∏è Ubicaci√≥n encontrada', `Mostrando ${nombre} en el mapa`);
        }
        
        // ===== SISTEMA =====
        function mostrarSeccion(seccion) {
            // Ocultar todas las secciones
            document.querySelectorAll('.seccion').forEach(s => {
                s.style.display = 'none';
            });
            
            // Remover active de todas las pesta√±as
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
            });
            
            // Mostrar secci√≥n seleccionada
            document.getElementById(seccion).style.display = 'block';
            
            // Marcar pesta√±a como activa
            event.target.classList.add('active');
            
            // Si es la secci√≥n de mapa y no est√° inicializado, inicializarlo
            if (seccion === 'mapa' && !mapa && typeof google !== 'undefined') {
                setTimeout(initMap, 500);
            }
            
            // Si es la secci√≥n de noticias y no est√°n cargadas, cargarlas
            if (seccion === 'noticias' && noticiasCargadas.length === 0) {
                setTimeout(cargarNoticiasReales, 500);
            }
        }
        
        function actualizarEstadisticas() {
            // Actualizar contadores
            document.getElementById('total-municipios').textContent = municipiosCordoba.length;
            
            const totalRobos = municipiosCordoba.reduce((sum, m) => sum + m.robos, 0);
            const totalOportunidades = municipiosCordoba.reduce((sum, m) => sum + m.oportunidades, 0);
            
            document.getElementById('robos-semana').textContent = totalRobos;
            document.getElementById('oportunidades-semana').textContent = totalOportunidades;
            
            // Calcular municipios cr√≠ticos (prioridad alta)
            const municipiosCriticos = municipiosCordoba.filter(m => m.prioridad === 'alta').length;
            document.getElementById('municipios-criticos').textContent = municipiosCriticos;
            
            // Tasa de conversi√≥n estimada
            const tasaConversion = municipiosCriticos > 0 ? '24%' : '15%';
            document.getElementById('tasa-conversion').textContent = tasaConversion;
        }
        
        function actualizarHora() {
            const ahora = new Date();
            const hora = ahora.getHours().toString().padStart(2, '0');
            const minutos = ahora.getMinutes().toString().padStart(2, '0');
            
            document.getElementById('hora-actual').textContent = `${hora}:${minutos}`;
            document.getElementById('ultima-actualizacion').textContent = 
                `√öltima actualizaci√≥n: ${hora}:${minutos}`;
            
            setTimeout(actualizarHora, 60000);
        }
        
        function iniciarActualizacionesAutomaticas() {
            // Actualizar noticias cada 5 minutos
            setInterval(cargarNoticiasReales, 300000);
            
            // Actualizar estad√≠sticas cada minuto
            setInterval(actualizarEstadisticas, 60000);
            
            // Simular nueva noticia ocasionalmente
            setInterval(() => {
                if (Math.random() > 0.8) {
                    simularNuevaNoticia();
                }
            }, 600000);
        }
        
        function simularNuevaNoticia() {
            const municipios = ["C√ìRDOBA", "LUCENA", "PUENTE GENIL", "MONTILLA"];
            const tipos = ["robo", "intento", "seguridad", "comunidad"];
            const fuentes = ["Diario C√≥rdoba", "Cord√≥polis", "ABC C√≥rdoba", "El Diario de C√≥rdoba"];
            
            const nuevaNoticia = {
                titulo: `Nuevo incidente reportado en ${municipios[Math.floor(Math.random() * municipios.length)]}`,
                fuente: fuentes[Math.floor(Math.random() * fuentes.length)],
                fecha: "Hace unos minutos",
                contenido: "Vecinos reportan actividad sospechosa en la zona. La polic√≠a ha sido alertada.",
                municipio: municipios[Math.floor(Math.random() * municipios.length)],
                tipo: tipos[Math.floor(Math.random() * tipos.length)]
            };
            
            noticiasCargadas.unshift(nuevaNoticia);
            
            if (noticiasCargadas.length > 20) {
                noticiasCargadas.pop();
            }
            
            // Actualizar display si estamos en la secci√≥n de noticias
            if (document.getElementById('noticias').style.display !== 'none') {
                mostrarNoticias(noticiasCargadas);
            }
            
            mostrarNotificacion('üì∞ Nueva noticia', nuevaNoticia.titulo);
        }
        
        function mostrarNotificacion(titulo, mensaje) {
            const notificacion = document.getElementById('notificacion');
            const tituloElem = document.getElementById('notificacion-titulo');
            const mensajeElem = document.getElementById('notificacion-mensaje');
            
            tituloElem.textContent = titulo;
            mensajeElem.textContent = mensaje;
            notificacion.style.display = 'block';
            
            setTimeout(() => {
                notificacion.style.display = 'none';
            }, 4000);
        }
        
        // Detectar cambios de conexi√≥n
        window.addEventListener('online', () => {
            document.getElementById('estado-conexion').textContent = '‚úÖ Conectado';
            document.getElementById('estado-sistema').textContent = '‚úÖ Sistema activo';
            mostrarNotificacion('‚úÖ Conexi√≥n restablecida', 'Sistema sincronizado');
        });
        
        window.addEventListener('offline', () => {
            document.getElementById('estado-conexion').textContent = '‚ö†Ô∏è Offline';
            document.getElementById('estado-sistema').textContent = '‚ö†Ô∏è Modo offline';
            mostrarNotificacion('‚ö†Ô∏è Sin conexi√≥n', 'Trabajando con datos locales');
        });
        
        // Inicializar cuando se carga la API de Google Maps
        window.initMap = initMap;
    </script>
</body>
</html>
